var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,n=(e,t)=>{for(var r in t||(t={}))s.call(t,r)&&l(e,r,t[r]);if(a)for(var r of a(t))o.call(t,r)&&l(e,r,t[r]);return e},i=(e,a)=>t(e,r(a)),c=(e,t,r)=>new Promise((a,s)=>{var o=e=>{try{n(r.next(e))}catch(t){s(t)}},l=e=>{try{n(r.throw(e))}catch(t){s(t)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,l);n((r=r.apply(e,t)).next())});import{j as d,g as m}from"./index-BUhAnNb8.js";import{r as u}from"./vendor-CTfkm-R-.js";import{a as h}from"./ui-BGB9AJWZ.js";import"./utils-DxzDoEX4.js";function x({time:e}){try{const t=Date.now()-new Date(e).getTime(),r=Math.floor(t/1e3);if(r<60)return d.jsxs("span",{children:[r,"s"]});const a=Math.floor(r/60);if(a<60)return d.jsxs("span",{children:[a,"m"]});const s=Math.floor(a/60);if(s<24)return d.jsxs("span",{children:[s,"h"]});const o=Math.floor(s/24);return d.jsxs("span",{children:[o,"d"]})}catch(t){return d.jsx("span",{children:"-"})}}function f({feedId:e,currentUser:t,comments:r,setComments:a}){var s;const[o,l]=u.useState(""),f=()=>c(null,null,function*(){var r;const s=o.trim();if(s&&t)try{const t=m(),o=yield h.post(`${t}/api/media/feed/${e}/comments`,{content:s},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});(null==(r=o.data)?void 0:r.success)&&(a(t=>i(n({},t),{[e]:[...t[e]||[],o.data.comment]})),l(""))}catch(c){console.error("Failed to add comment:",c)}});return d.jsxs("div",{className:"px-3 pb-3 border-t dark:border-gray-700",children:[t&&d.jsxs("div",{className:"flex gap-2 mt-3",children:[d.jsx("img",{src:t.avatarUrl?t.avatarUrl.startsWith("http")?t.avatarUrl:`${m()}${t.avatarUrl}`:"/favicon.ico",alt:"your avatar",className:"w-8 h-8 rounded-full object-cover flex-shrink-0"}),d.jsxs("div",{className:"flex-1 flex gap-2",children:[d.jsx("input",{type:"text",placeholder:"Write a comment...",value:o,onChange:e=>l(e.target.value),onKeyPress:e=>"Enter"===e.key&&f(),className:"flex-1 px-3 py-2 text-sm border rounded-full dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"}),d.jsx("button",{onClick:f,disabled:!o.trim(),className:"px-4 py-2 bg-blue-500 text-white text-sm rounded-full hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Post"})]})]}),d.jsx("div",{className:"mt-3 space-y-3",children:null==(s=r[e])?void 0:s.map(r=>{var s,o,l,u;return d.jsxs("div",{className:"flex gap-2",children:[d.jsx("img",{src:(null==(s=r.author)?void 0:s.avatarUrl)?r.author.avatarUrl.startsWith("http")?r.author.avatarUrl:`${m()}${r.author.avatarUrl}`:"/favicon.ico",alt:"avatar",className:"w-8 h-8 rounded-full object-cover flex-shrink-0"}),d.jsx("div",{className:"flex-1",children:d.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-lg px-3 py-2",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm font-semibold",children:(null==(o=r.author)?void 0:o.name)||(null==(l=r.author)?void 0:l.username)||"User"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(x,{time:r.createdAt}),t&&(null==(u=r.author)?void 0:u._id)===t._id&&d.jsx("button",{onClick:()=>c(null,null,function*(){if(confirm("Delete this comment?"))try{const t=m();yield h.delete(`${t}/api/media/comments/${r._id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),a(t=>i(n({},t),{[e]:t[e].filter(e=>e._id!==r._id)}))}catch(t){console.error("Failed to delete comment:",t)}}),className:"text-xs text-gray-500 hover:text-red-500",children:"Ã—"})]})]}),d.jsx("p",{className:"text-sm mt-1",children:r.content})]})})]},r._id)})})]})}export{f as default};
