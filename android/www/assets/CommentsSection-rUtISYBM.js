var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,n=(e,t)=>{for(var r in t||(t={}))s.call(t,r)&&o(e,r,t[r]);if(a)for(var r of a(t))l.call(t,r)&&o(e,r,t[r]);return e},c=(e,a)=>t(e,r(a)),i=(e,t,r)=>new Promise((a,s)=>{var l=e=>{try{n(r.next(e))}catch(t){s(t)}},o=e=>{try{n(r.throw(e))}catch(t){s(t)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,o);n((r=r.apply(e,t)).next())});import{j as d,g as m}from"./index-N7HF82PV.js";import{r as u}from"./vendor-tm-Q2Jk-.js";import{a as h}from"./ui-BT4WTmIO.js";import"./utils-DI9M9ezF.js";function x({time:e}){try{const t=Date.now()-new Date(e).getTime(),r=Math.floor(t/1e3);if(r<60)return d.jsxs("span",{children:[r,"s"]});const a=Math.floor(r/60);if(a<60)return d.jsxs("span",{children:[a,"m"]});const s=Math.floor(a/60);if(s<24)return d.jsxs("span",{children:[s,"h"]});const l=Math.floor(s/24);return d.jsxs("span",{children:[l,"d"]})}catch(t){return d.jsx("span",{children:"-"})}}function f({feedId:e,currentUser:t,comments:r,setComments:a}){var s;const[l,o]=u.useState(""),f=()=>i(null,null,function*(){var r;const s=l.trim();if(s&&t)try{const t=m(),l=yield h.post(`${t}/api/media/feed/${e}/comments`,{content:s},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});(null==(r=l.data)?void 0:r.success)&&(a(t=>c(n({},t),{[e]:[...t[e]||[],l.data.comment]})),o(""))}catch(i){console.error("Failed to add comment:",i)}});return d.jsxs("div",{className:"px-3 pb-3 border-t dark:border-gray-700",children:[t&&d.jsxs("div",{className:"flex gap-2 mt-3",children:[d.jsx("img",{src:t.avatarUrl?t.avatarUrl.startsWith("http")?t.avatarUrl:`${m()}${t.avatarUrl}`:"/favicon.ico",alt:"your avatar",className:"w-8 h-8 rounded-full object-cover flex-shrink-0",onError:e=>{e.target.src=`data:image/svg+xml;base64,${btoa('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="16" fill="#e5e7eb"/><circle cx="16" cy="12" r="5" fill="#9ca3af"/><path d="M5 27c0-5.5 4.5-10 10-10s10 4.5 10 10" fill="#9ca3af"/></svg>')}`}}),d.jsxs("div",{className:"flex-1 flex gap-2",children:[d.jsx("input",{type:"text",placeholder:"Write a comment...",value:l,onChange:e=>o(e.target.value),onKeyPress:e=>"Enter"===e.key&&f(),className:"flex-1 px-3 py-2 text-sm border rounded-full dark:bg-gray-700 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"}),d.jsx("button",{onClick:f,disabled:!l.trim(),className:"px-4 py-2 bg-blue-500 text-white text-sm rounded-full hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Post"})]})]}),d.jsx("div",{className:"mt-3 space-y-3",children:null==(s=r[e])?void 0:s.map(r=>{var s,l,o,u;return d.jsxs("div",{className:"flex gap-2",children:[d.jsx("img",{src:(null==(s=r.author)?void 0:s.avatarUrl)?r.author.avatarUrl.startsWith("http")?r.author.avatarUrl:`${m()}${r.author.avatarUrl}`:"/favicon.ico",alt:"avatar",className:"w-8 h-8 rounded-full object-cover flex-shrink-0",onError:e=>{e.target.src=`data:image/svg+xml;base64,${btoa('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="16" fill="#e5e7eb"/><circle cx="16" cy="12" r="5" fill="#9ca3af"/><path d="M5 27c0-5.5 4.5-10 10-10s10 4.5 10 10" fill="#9ca3af"/></svg>')}`}}),d.jsx("div",{className:"flex-1",children:d.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-lg px-3 py-2",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm font-semibold",children:(null==(l=r.author)?void 0:l.name)||(null==(o=r.author)?void 0:o.username)||"User"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(x,{time:r.createdAt}),t&&(null==(u=r.author)?void 0:u._id)===t._id&&d.jsx("button",{onClick:()=>i(null,null,function*(){if(confirm("Delete this comment?"))try{const t=m();yield h.delete(`${t}/api/media/comments/${r._id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),a(t=>c(n({},t),{[e]:t[e].filter(e=>e._id!==r._id)}))}catch(t){console.error("Failed to delete comment:",t)}}),className:"text-xs text-gray-500 hover:text-red-500",children:"Ã—"})]})]}),d.jsx("p",{className:"text-sm mt-1",children:r.content})]})})]},r._id)})})]})}export{f as default};
